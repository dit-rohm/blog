<!DOCTYPE html> <html lang=ja> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content='IE=edge'> <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <title>アセンブリーでHello, World! - DIT Mentor Blog</title> <meta name=keywords content="アセンブリ言語,Hello world,Intel"> <meta name=description content="Intel Syntaxのアセンブリー言語でHello, Worldを書いてみます。"> <meta property="og:site_name" content="DIT Mentor Blog"> <meta property="og:title" content="アセンブリーでHello, World!"> <meta property="og:description" content="Intel Syntaxのアセンブリー言語でHello, Worldを書いてみます。"> <meta property="og:type" content=article> <meta property="og:url" content="https://blog.dit-rohm.com/2015/06/02/hello-world-with-asm.html"> <meta property="og:image" content="https://blog.dit-rohm.com/images/2015-06-02/qemu.png"> <meta property="fb:app_id" content=866054163477643> <meta name="twitter:card" content=summary_large_image> <meta name="twitter:site" content="@dit_rohm"> <link href="/images/favicon.png" rel=icon type="image/png"/> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> <link href="/stylesheets/blog.css" rel=stylesheet /> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-61361620-3', 'auto');
  ga('send', 'pageview');
</script> </head> <body> <header class=blog_header> <nav class="navbar navbar-default navbar-fixed-top"> <div class=container-fluid> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target="#bs-example-navbar-collapse-1"> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href="https://dit-rohm.com/">DIT</a> </div> <div class="collapse navbar-collapse" id=bs-example-navbar-collapse-1> <ul class="nav navbar-nav"> <li class=active><a href="/">Blog Home</a></li> <li class=dropdown> <a href="#" class=dropdown-toggle data-toggle=dropdown>Tags <b class=caret></b></a> <ul class=dropdown-menu> <li> <a href="/tags/Debian.html">Debian</a> </li> <li> <a href="/tags/Linux.html">Linux</a> </li> <li> <a href="/tags/VPS.html">VPS</a> </li> <li> <a href="/tags/アプリ.html">アプリ</a> </li> <li> <a href="/tags/カメラ.html">カメラ</a> </li> <li> <a href="/tags/音楽.html">音楽</a> </li> </ul> </li> <li class=dropdown> <a href="#" class=dropdown-toggle data-toggle=dropdown>Archives <b class=caret></b></a> <ul class=dropdown-menu role=menu> <li role=presentation class=dropdown-header>2015年</li> <li><a href="/2015/11.html">11月</a></li> <li><a href="/2015/08.html">08月</a></li> <li><a href="/2015/07.html">07月</a></li> <li><a href="/2015/06.html">06月</a></li> <li><a href="/2015/05.html">05月</a></li> </ul> </li> </ul> </div> </div> </nav> <div class="jumbotron top-catch"> <h1 class=midashi-en><a href="/">DIT Mentor Blog</a></h1> <hr class=header-hr> <h5 class=midashi-ja>DITメンターブログ</h5> </div> </header> <div id=main role=main> <div class=container> <div class=row> <div class=col-sm-1> </div> <div class=col-sm-2> <p class=tags>Tags</p> </div> <div class="col-sm-7 post"> <h1 class=article-title>アセンブリーでHello, World!</h1> <p class=article-date>2015/06/02</p> <hr> <p>こんにちは。 DITメンターのともくんです。<br> プログラミングの学習を始めてほとんどの人が始めに作るであろうプログラムは、標準出力に<code>&quot;Hello, World!&quot;</code>と表示するものでしょう。C言語なら<code>printf(&quot;Hello, World!&quot;)</code>などといった様子でしょう。関数を呼び出すとOSが標準出力に文字列が表示されるのは便利なこのですが、その舞台裏も気になるところだと思います。今日は、OSに頼らずに画面に文字を表示するようなプログラムを取り上げたいと思います。<br> 今回は、Intel SyntaxのアセンブリーをNASMでアセンブルして使います。コードは以下のようになります。<code>;</code>より右はコメントであり、動作の解説を加えています。</p> <pre class="highlight plaintext"><code>;hello.asm

bits 16        ;16ビットのコードであることを示す。Real Modeで動きます
org 0x7c00     ;アドレスの基準が0x7c00になるようにする

start:
jmp loader     ;printのルーチンを飛ばし、実行をloaderにジャンプさせる

print:
lodsb          ;文字列の次の文字を読み出し、alレジスタに格納する
or al, al      ;もしその文字がNULLなら、終了へジャンプする
jz done
mov ah, 0eh    ;int 10hを文字の書き出しをするモードする
int 10h        ;BIOSの割込み処理で、文字を書き出す
jmp print      ;上に戻って繰り返す
done:
ret

loader:
xor ax, ax     ;まず、この3行でセグメントの開始地点を0にする
mov ds, ax
mov es, ax

mov si, string ;下の文字列のあるアドレスをsiレジスタに入れる
call print     ;画面に表示するルーチンの呼び出し
cli
hlt

string db "Hello, World!", 0

times 510 - ($ - $$) db 0
dw 0xAA55      ;上の行と組み合わせて、ブートセクタであることを示している
</code></pre> <p>上のコードは16 bit Real Modeで動くので、画面への文字表示はBIOSの割込み処理である<code>int 10h</code>を使っています。32 bit Protected Modeにプロセッサのモードを変えるとBIOSの割込み処理すら使えなくなるのでメモリに直接書き込む必要が出てくるのですが、それは今日は扱いません。<br> また、<code>lodbs</code>はsiレジスタがさす文字列の文字を1文字ずつ順にahレジスタに読み込んでいく命令です。これを使っているため、ループのカウンタとなるレジスタがありません。 </p> <p>また、最後の部分は、510バイト目からの2バイトに0xAA55(16進数)を入れることで、これがブートセクタであることを示しています。ブートセクタとは、BIOSがコンピューターの起動の際に一番最初にメモリに読み込んで実行する512バイトの領域のことです。普通ならここにファイルシステムの情報とOSのカーネルを呼び出すコードが書かれていますが、今日は<code>&quot;Hello, World&quot;</code>と表示するプログラムが置かれています。 </p> <p>これを、NASMでアセンブルします。NASMはIntel Syntaxのアセンブリーのためのアセンブラーです。上のコードを実行してみたい方は各自入手してください。(2-clause BSD Licenseで配布されているオープンソースソフトウェアです。) </p> <p><code>nasm -f bin -o hello.bin hello.asm</code> </p> <p>アセンブルをするとバイナリファイルが出てくるので、これを起動ディスクとして仮想マシンで実行してみてください。また、実際のハードウェアで動かした場合のハードウェアの破損に対する責任は負いかねます。<br> 実行結果は以下のようになります。 </p> <p><img title="実行結果" alt="実行結果" src="/images/2015-06-02/qemu.png"/></p> <p>いかがでしょうか。文字をパソコンの画面に表示だけでも実は奥が深いものです。</p> </div> <div class=col-sm-2> </div> </div> </div> </div> <div class="social-buttons clearfix"> <ul> <li> <a href="https://twitter.com/share" class=twitter-share-button data-url="https://blog.dit-rohm.com/2015/06/02/hello-world-with-asm.html" data-via=dit_rohm data-related=dit_rohm>Tweet</a> </li> <li> <div class=fb-share-button data-href="https://blog.dit-rohm.com/2015/06/02/hello-world-with-asm.html" data-layout=button_count></div> </li> <li> <a data-pocket-label=pocket data-pocket-count=horizontal class=pocket-btn data-lang=en></a> </li> <li> <a href="https://b.hatena.ne.jp/entry/https://blog.dit-rohm.com/2015/06/02/hello-world-with-asm.html" class=hatena-bookmark-button data-hatena-bookmark-title="アセンブリーでHello, World! - dit" data-hatena-bookmark-layout=standard-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"> <img src="https://b.st-hatena.com/images/entry-button/button-only.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"/></a> </li> </ul> </div> <footer class=blog_footer> <div class="inner container"> <div class=row> <div class="col-md-4 col-sm-6 footer-content"> <h3>Recent Post</h3> <ul> <li><p class=post-date><time datetime="2015-11-17T17:43">2015/11/17</time></p> <p class=post-title><a href="/2015/11/17/recurrent-neural-network.html">ディープラーニングで講義のレポートを自動執筆</a></p></li> </ul> <ul> <li><p class=post-date><time datetime="2015-11-10T21:00">2015/11/10</time></p> <p class=post-title><a href="/2015/11/10/hackathon.html">初心者がハッカソンに参加してみた結果</a></p></li> </ul> <ul> <li><p class=post-date><time datetime="2015-08-13T00:00">2015/08/13</time></p> <p class=post-title><a href="/2015/08/13/IP.html">知っておくべき知的財産権　著作権</a></p></li> </ul> <ul> <li><p class=post-date><time datetime="2015-08-06T21:13">2015/08/06</time></p> <p class=post-title><a href="/2015/08/06/bilingual-news.html">バイリンガルニュースのおすすめ回6選</a></p></li> </ul> <ul> <li><p class=post-date><time datetime="2015-07-28T10:00">2015/07/28</time></p> <p class=post-title><a href="/2015/07/28/on-the-train.html">通学中の暇つぶしにおすすめなこと15選</a></p></li> </ul> </div> <div class="col-md-4 col-sm-6 footer-content"> <h3>About Author</h3> <p class=about-auther>DIT（Doshisha Institute of Technology）は、技術力向上を目的とし同志社／同志社女子大学の学生向けに勉強会やハッカソンを開催する<a href="http://rohm.doshisha.ac.jp/" target=_blank>ローム記念館プロジェクト</a>です。</p> <p class=about-auther>このブログではDITのお知らせ、活動報告のほかに開発、プログラミング等についても書いていきます。</p> <div class=sns-link> <h4>- SNS</h4> <a href="https://twitter.com/dit_rohm/" target=_blank><img src="/images/twitter_logo.png" alt=Twitter></a> <a href="https://facebook.com/dit_rohm/" target=_blank><img src="/images/fb_logo.png" alt=Facebook></a> </div> </div> <div class="col-md-4 col-sm-6 footer-content"> <h3>DIT Website</h3> <p class=about-auther>DITのウェブサイトです。DITについてや参加申し込み、FAQなどはこちらのサイトをご覧ください。</p> <ul> <li><p class=dit-link><a href="https://dit-rohm.com/">HOME</a></p></li> <li><p class=dit-link><a href="https://dit-rohm.com/about.html">ABOUT</a></p></li> <li><p class=dit-link><a href="https://dit-rohm.com/faq.html">FAQ</a></p></li> </ul> </div> </div> <p class=copyright><small>&copy; DIT 2015</small></p> </div> </footer> <script src="/javascripts/all.js"></script> </body> </html>